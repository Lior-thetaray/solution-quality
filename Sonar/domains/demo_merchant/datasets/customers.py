from thetaray.api.solution import DataSet, Field, DataType, IngestionMode

def customers_dataset():
    return DataSet(
        identifier='demo_merchant_customers',
        display_name='Merchant Acquiring - Merchants',
        ingestion_mode=IngestionMode.UPDATE,
        publish=True,
        primary_key=['merchant_id'],   # <-- coincide con el KYC
        num_of_partitions=1,
        num_of_buckets=1,
        data_permission="dpv:demo_merchant",
        field_list=[
            # --- Identification / registration ---
            Field(identifier='merchant_id',
                  display_name='Merchant ID',
                  data_type=DataType.STRING),
            Field(identifier='legal_name',
                  display_name='Legal Name',
                  data_type=DataType.STRING),
            Field(identifier='business_name',
                  display_name='Business Name',
                  data_type=DataType.STRING),
            Field(identifier='business_type',
                  display_name='Business Type',
                  data_type=DataType.STRING),
            Field(identifier='incorporation_date',
                  display_name='Incorporation Date',
                  data_type=DataType.TIMESTAMP,
                  comment='Format: yyyy-MM-dd'),
            Field(identifier='tax_id_ein',
                  display_name='Tax ID / EIN',
                  data_type=DataType.STRING),

            # --- Location / contact ---
            Field(identifier='country',
                  display_name='Country',
                  data_type=DataType.STRING),
            Field(identifier='state',
                  display_name='State',
                  data_type=DataType.STRING),
            Field(identifier='city',
                  display_name='City',
                  data_type=DataType.STRING),
            Field(identifier='postal_code',
                  display_name='Postal Code',
                  data_type=DataType.STRING),
            Field(identifier='address_line',
                  display_name='Address Line',
                  data_type=DataType.STRING),
            Field(identifier='phone_number',
                  display_name='Phone Number',
                  data_type=DataType.STRING),
            Field(identifier='email',
                  display_name='Email',
                  data_type=DataType.STRING),
            Field(identifier='website',
                  display_name='Website',
                  data_type=DataType.STRING),

            # --- MCC ---
            Field(identifier='mcc',
                  display_name='Merchant Category Code (MCC)',
                  data_type=DataType.STRING),
            Field(identifier='mcc_description',
                  display_name='MCC Description',
                  data_type=DataType.STRING),

            # --- Declared economic profile ---
            Field(identifier='average_ticket_declared',
                  display_name='Average Ticket Declared',
                  data_type=DataType.DOUBLE),
            Field(identifier='monthly_volume_declared',
                  display_name='Monthly Volume Declared',
                  data_type=DataType.DOUBLE),
            Field(identifier='refund_policy_days',
                  display_name='Refund Policy Days',
                  data_type=DataType.LONG),
            Field(identifier='chargeback_contact_email',
                  display_name='Chargeback Contact Email',
                  data_type=DataType.STRING),

            # --- Ownership structure ---
            Field(identifier='beneficial_owners_count',
                  display_name='Beneficial Owners Count',
                  data_type=DataType.LONG),
            Field(identifier='top_owner_share',
                  display_name='Top Owner Share',
                  data_type=DataType.DOUBLE),

            # --- AML / compliance flags ---
            Field(identifier='sanctioned_hit',
                  display_name='Sanctioned Hit',
                  data_type=DataType.BOOLEAN),
            Field(identifier='pep_beneficial_owner',
                  display_name='PEP Beneficial Owner',
                  data_type=DataType.BOOLEAN),
            Field(identifier='adverse_media',
                  display_name='Adverse Media',
                  data_type=DataType.BOOLEAN),
            Field(identifier='missing_kyc_docs',
                  display_name='Missing KYC Docs',
                  data_type=DataType.BOOLEAN),
            Field(identifier='incorrect_tax_id_format',
                  display_name='Incorrect Tax ID Format',
                  data_type=DataType.BOOLEAN),
            Field(identifier='po_box_address',
                  display_name='PO Box Address',
                  data_type=DataType.BOOLEAN),
            Field(identifier='high_risk_industry',
                  display_name='High Risk Industry',
                  data_type=DataType.BOOLEAN),

            # --- Scoring ---
            Field(identifier='risk_score',
                  display_name='Risk Score',
                  data_type=DataType.DOUBLE),
        ],
    )

def entities():
    return [customers_dataset()]
